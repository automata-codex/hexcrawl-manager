---
import { getCollection } from 'astro:content';

import type { SessionData } from '@skyreach/schemas';

interface Props {
  character: CharacterData;
}

type CharacterData = SessionData['characterIds'][0];

const { character } = Astro.props;

const characterData = await getCollection('characters');
const playerData = await getCollection('players');

function getCharacterName(characterId: string): string {
  const character = characterData.find((char) => char.id === characterId);
  return character ? character.data.displayName : 'Unknown Character';
}

function getPlayerName(characterId: string): string {
  const character = characterData.find((char) => char.id === characterId);
  if (!character) return 'Unknown Player';
  const player = playerData.find(
    (player) => player.id === character.data.playerId,
  );
  return player ? player.data.displayName : 'Unknown Player';
}

let characterName = '';
let playerName = '';
if (typeof character === 'string') {
  characterName = getCharacterName(character);
  playerName = getPlayerName(character);
} else if ('characterName' in character && 'playerName' in character) {
  characterName = character.characterName as string;
  playerName = character.playerName as string;
}
---

{characterName} ({playerName})
