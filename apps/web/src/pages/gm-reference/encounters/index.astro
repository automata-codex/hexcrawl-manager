---
import EncounterList from '../../../components/EncounterList.svelte';
import SecretLayout from '../../../layouts/SecretLayout.astro';
import {
  extractFilterOptions,
  loadAugmentedEncounters,
} from '../../../utils/load-augmented-encounters';

const { encounters: augmentedEncounters } = await loadAugmentedEncounters();

// Sort by name
const sortedEncounters = augmentedEncounters.sort((a, b) =>
  a.data.name.localeCompare(b.data.name),
);

// Transform to serializable format for Svelte
const encounters = sortedEncounters.map((enc) => ({
  id: enc.id,
  name: enc.data.name,
  scope: enc.data.scope,
  locationTypes: enc.data.locationTypes || [],
  factions: enc.data.factions || [],
  creatureTypes: enc.data.creatureTypes || [],
  isLead: enc.data.isLead || false,
  isUsed: enc.data.usedIn.length > 0,
}));

const filterOptions = extractFilterOptions(sortedEncounters);
const title = 'Encounters';
---

<SecretLayout title={title}>
  <EncounterList client:load {encounters} {filterOptions} />
</SecretLayout>
