---
import { getEntry } from 'astro:content';
import { renderBulletMarkdown, renderMarkdown, renderSubArticleMarkdown } from '../utils/markdown';
import type { DungeonEntry } from '../types';

interface Props {
  dungeon: DungeonEntry;
  isSubcomponent?: boolean;
}

const { dungeon, isSubcomponent = false } = Astro.props;
const hexData = await getEntry('hexes', dungeon.data.hexId);
if (!hexData) {
  throw new Error('Hex not found: ' + dungeon.data.hexId);
}

const content = isSubcomponent ? await renderSubArticleMarkdown(dungeon.body ?? '') : await renderMarkdown(dungeon.body ?? '');
---
<style>
    .dungeon-data-bar {
        display: flex;
    }

    .dungeon-data-bar > div {
        font-weight: bold;
        margin-right: 1rem;
    }

    .dungeon-source {
        font-weight: bold;
    }

    .maps {
        font-weight: bold;
    }

    .spacer {
        margin-bottom: 1rem;
    }
</style>
<div class="dungeon-data-bar">
  <div>
    Hex:
    <a href={`/hexes/${hexData.id}`}>
      {renderBulletMarkdown(`${hexData.data.id.toUpperCase()} "${hexData.data.name}"`)}
    </a>
  </div>
  {isSubcomponent && (
    <div>
      <a href={`/dungeons/${dungeon.id}`}>
        View Dungeon
      </a>
    </div>
  )}
</div>
{dungeon.data.source && (
  <div class="dungeon-source">
    Source: <Fragment set:html={renderBulletMarkdown(dungeon.data.source)} />
  </div>
)}
{dungeon.data.images && (
    <div>
      <p class="maps">Maps:</p>
      <ul>
        {dungeon.data.images.map((image) => (
          <li>
            <a
              href={`/images/maps/dungeons/${image.filename}`}
              target="_blank"
              rel="noopener noreferrer"
            >
              {image.description}
            </a>
          </li>
        ))}
      </ul>
    </div>
  )}
<div class="spacer"></div>
<Fragment set:html={content} />
