---
import { canAccess, getCurrentUserRole } from '../../utils/auth';
import { SCOPES } from '../../utils/constants';
import { renderBulletMarkdown } from '../../utils/markdown';
import type { HexData } from '../../types';

interface Props {
  hex: HexData;
}

const { hex } = Astro.props;

const { hiddenSites = [] } = hex;

const role = getCurrentUserRole(Astro.locals);

// If you're a GM, and there are no hidden sites, return null
if (canAccess(role, [SCOPES.GM]) && hiddenSites.length === 0) {
  return null;
}

// If you're public or player, and either the hex is not explored or it has no hidden sites, return null
if (canAccess(role, [SCOPES.PLAYER, SCOPES.PUBLIC]) && (!hex.isExplored || hiddenSites.length === 0)) {
  return null;
}
---
<style>
    ul {
        margin-top: 0;
    }
</style>

{hiddenSites.length === 1 ? (
  <div class="hanging-indent">
    <span class="inline-heading">Hidden Site:</span>{' '}
    <Fragment set:html={renderBulletMarkdown(hiddenSites[0])} />
  </div>
) : (
  <div>
    <span class="inline-heading keep-with-next">Hidden Sites:</span>
  </div>
  <ul>
    {hiddenSites.map((site: string) => <li><Fragment set:html={renderBulletMarkdown(site)} /></li>)}
  </ul>
)}
