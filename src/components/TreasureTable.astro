---
import { startCase, toLower } from 'lodash-es';
import type { TreasureData } from '../types';
import { renderBulletMarkdown } from '../utils/markdown';

interface Props {
  treasure: TreasureData[];
}

const { treasure } = Astro.props;

function formatValue(value?: number): string {
  return value != null ? `${value} gp` : '—';
}

function formatRarity(rarity?: string): string {
  return rarity ? startCase(toLower(rarity)) : '—';
}

function formatType(type?: string): string {
  return type ? startCase(toLower(type)) : '—';
}

async function formatNotes(notes?: string): Promise<string> {
  return notes ? await renderBulletMarkdown(notes) : '—';
}
---
<style>
    .container td, .container th {
        border-bottom: 1px solid var(--bulma-border);
        padding-right: 1rem;
        padding-top: 0.25rem;
        padding-bottom: 0.25rem;
    }

    .container th {
        border-top: 1px solid var(--bulma-border);
    }

    table {
        border-spacing: 0;
        margin: 1rem 0;
    }
    th, td {
        border-bottom: 1px solid var(--bulma-border);
        padding-right: 1rem;
        padding-top: 0.25rem;
        padding-bottom: 0.25rem;
    }
    th {
        border-top: 1px solid var(--bulma-border);
    }
</style>
{treasure.length > 0 && (
  <table class="treasure-table">
    <thead>
    <tr>
      <th>Item</th>
      <th>Value</th>
      <th>Type</th>
      <th>Rarity</th>
      <th>Notes</th>
    </tr>
    </thead>
    <tbody>
    {treasure.map((item) => (
      <tr>
        <td>{item.name}</td>
        <td>{formatValue(item.value)}</td>
        <td>{formatType(item.type)}</td>
        <td>{formatRarity(item.rarity)}</td>
        <td><Fragment set:html={formatNotes(item.notes)} /></td>
      </tr>
    ))}
    </tbody>
  </table>
)}
