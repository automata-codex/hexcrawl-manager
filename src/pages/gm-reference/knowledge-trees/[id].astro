---
import KnowledgeTree from '../../../components/KnowledgeTree.svelte';
import type { PlacementRef } from '../../../types';
import { knowledgeTrees } from '../../../utils/knowledge-trees';
import SecretLayout from '../../../layouts/SecretLayout.astro';

// Get the ID from the incoming server request
const { id } = Astro.params;
if (!id) {
  return new Response(null, {
    status: 404,
    statusText: 'Not found'
  });
}

const tree = knowledgeTrees[id];

if (!tree) {
  throw new Error(`Unknown knowledge tree: ${id}`);
}

// In the future, generate this from hexes/sites/dungeons
const placementMap: Record<string, PlacementRef[]> = {
  'crystals.tier1.color_meanings': [
    { type: 'hidden-site', id: 'prism_grove', label: 'Prism Grove' },
    { type: 'dungeon', id: 'skyforge_core', label: 'Skyforge Core' }
  ],
  'crystals.tier1.plant_growth': [
    { type: 'hidden-site', id: 'prism_grove', label: 'Prism Grove' },
  ],
};
---
<SecretLayout title="Knowledge Tree">
  <KnowledgeTree client:load node={tree} placementMap={placementMap} />
</SecretLayout>
