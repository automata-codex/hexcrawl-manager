---
import { getCollection, getEntry } from 'astro:content';

import Hex from '../components/Hex.astro';
import Layout from '../layouts/Layout.astro';
import { getHexesByRegion } from '../utils/region-hex-mapper';

const hexData = await getCollection('hexes');
const hexes = hexData
  .sort((a, b) => {
    const aCol = a.id.substring(0, 1);
    const aRow = parseInt(a.id.substring(1), 10);
    const bCol = b.id.substring(0, 1);
    const bRow = parseInt(b.id.substring(1), 10);
    if (aCol === bCol) {
      return aRow - bRow;
    } else {
      return aCol.localeCompare(bCol);
    }
  })
  .filter((hex) => !hex.data.hideInCatalog);

const region8Data = await getEntry('regions', 'region-8');
if (!region8Data) {
  throw new Error('Region 8 not found');
}
const hexesByRegion = await getHexesByRegion();

const title = 'Baruun Khil Hex Catalog';
---
<style is:global>
    html {
        text-wrap: pretty;
        orphans: 2;
        widows: 2;
    }

    h1, h2, h3, h4, h5, h6 {
        font-family: "Souvenir", serif;
        margin-top: 1rem;
        margin-bottom: 0.125rem;
    }

    p {
        margin-left: 1rem;
        text-indent: -1rem;
        margin-bottom: 0;
        margin-top: 0;
    }

    ul {
        padding-inline-start: 2rem;

        li {
            padding-left: 0;
            text-indent: 0;
        }
    }

    .inline-heading {
        font-weight: bold;
    }

    /* Declare a custom CSS class to make the icon look right */
    .svg-inline--fa {
        overflow: visible;
        box-sizing: content-box;
        display: inline-block;
        height: 1em;
        vertical-align: -0.125em;
    }

    @media print {
        @page {
            size: letter portrait;
            margin: 0.5in;
        }

        body {
            font-size: 12pt;
            hyphens: auto;
            line-height: 1.15;
        }

        h1 {
            font-size: 36pt;
            margin-bottom: 12pt;
        }

        h2 {
            font-size: 15pt;
            margin-bottom: 6pt;
            page-break-after: avoid;
        }

        .keep-with-next {
            page-break-after: avoid;
        }
    }
</style>

<style>
    h1 {
        margin-top: 0;
        text-align: center;
    }

    @media print {
        main {
            columns: 2;
            column-fill: auto;
        }
    }
</style>

<Layout title={title}>
  <h1>{title}</h1>
  <pre>{JSON.stringify(hexesByRegion[region8Data.id], null, 2)}</pre>
  <main>
    {
      hexes.map((value) =>
        <Hex hex={value.data} />)
    }
  </main>
</Layout>
