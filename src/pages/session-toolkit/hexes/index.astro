---
import { getCollection } from 'astro:content';
import HexSearch from '../../../components/GmHexDetails/HexSearch.svelte';
import SecretLayout from '../../../layouts/SecretLayout.astro';
import type { ExtendedHexData } from '../../../types';
import { hexSort, processHex } from '../../../utils/hexes';
import { knowledgeTrees } from '../../../utils/knowledge-trees';

const dungeons = await getCollection('dungeons');
const hexEntries = await getCollection('hexes');
const intermediateHexes = hexEntries
  .map((entry) => entry.data)
  .sort(hexSort)
  .filter((hex) => !hex.hideInCatalog);
const hexes: ExtendedHexData[] = await Promise.all(
  intermediateHexes.map(processHex)
);
---
<SecretLayout title="Hex Catalog">
  <HexSearch
    client:load
    dungeons={dungeons}
    hexes={hexes}
    knowledgeTrees={knowledgeTrees}
  />
</SecretLayout>
