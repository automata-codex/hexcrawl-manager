---
import { getEntry } from 'astro:content';
import ArticleLayout from '../../layouts/ArticleLayout.astro';
import { renderMarkdown } from '../../utils/markdown';
import { canAccess, getCurrentUserRole } from '../../utils/auth';
import { SCOPES } from '../../utils/constants';

const role = getCurrentUserRole(Astro.locals);
if (canAccess(role, [SCOPES.PLAYER, SCOPES.PUBLIC])) {
  Astro.response.status = 404;
  Astro.response.statusText = 'Not found';
}

const article = await getEntry('articles', 'western-frontier-gms-notes');
if (!article) {
  throw new Error('Article not found');
}
const { title } = article.data;
---
<ArticleLayout title={title}>
  <article>
    <Fragment set:html={renderMarkdown(article.body ?? '')} />
  </article>
</ArticleLayout>
